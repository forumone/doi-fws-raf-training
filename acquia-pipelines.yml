version: 1.3.0

services:
  - php:
      version: 8.3
  - mysql
  - memcached

events:
  build:
    when:
      branch:
        - integration
        - main
        - live
    steps:
      - setup:
          type: script
          script:
            - echo "Building for branch: $PIPELINES_BRANCH"
            - composer install
            - vendor/bin/drush deploy
            - cd web/themes/custom/fws_raf
            - npm ci
            - npm run build
            - cd $SOURCE_DIR
            - rsync -av web/themes/custom/fws_raf $BUILD_DIR/web/themes/custom/ --exclude=node_modules
            